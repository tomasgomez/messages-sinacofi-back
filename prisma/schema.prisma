// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://sinacofi:hola123@34.135.68.241:5432/message"
}

model CUK {
  id                     String    @id @default(uuid())
  name                   String?
  cukCode                String?   @unique
  description            String?
  status                 String?
  creationDate           String?
  foreclosureDate        String?
  channel                String?
  clientDni              String?
  clientName             String?
  institutionDestination String?
  rutSeller              String?
  region                 String?
  debtorRut              String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  messages               Message[] @relation(name: "CukMessages")
}

model Message {
  id           String   @id @default(uuid())
  TSN          Int?     @unique @default(autoincrement()) //TODO: Check correlation with NSE, OSN, etc.
  OSN          Int?     @unique @default(autoincrement())
  NSE          Int?     @unique @default(autoincrement())
  LSN          Int?     @unique @default(autoincrement())
  NSR          Int?     @unique @default(autoincrement())
  messageCode  String?
  description  String?
  priority     String?
  status       String?
  sender       String?
  creationDate String?
  creationTime String?
  receiver     String?
  receivedDate String?
  receivedTime String?
  documents    String?
  actions      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  cukCode String?

  parameters Parameters[]
  files      File[]
  cuk        CUK?         @relation(fields: [cukCode], references: [cukCode], name: "CukMessages")
}

model Parameters {
  id           String   @id @default(uuid())
  name         String?
  messageCode  String?
  label        String?
  type         String?
  placeholder  String?
  description  String?
  defaultValue String?
  priority     Int
  value        String?
  properties   Json
  validations  Json
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  messageId String
  Message   Message @relation(fields: [messageId], references: [id])

  @@unique([name, messageCode])
  @@index([name])
}

model File {
  id        Int      @id @default(autoincrement())
  filename  String
  content   String
  url       String
  createdAt DateTime @default(now())

  messageId String
  Message   Message @relation(fields: [messageId], references: [id])
}

model Family {
  id        Int      @id @default(autoincrement())
  name      String   @unique @db.VarChar(255)
  createdAt DateTime @default(now())

  institutions String[]
}

model MessageFamily {
  messageId  Int
  familyId   Int
  createdAt  DateTime @default(now())
  assignedAt DateTime @default(now())

  @@id([messageId, familyId])
}
